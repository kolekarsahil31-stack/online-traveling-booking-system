<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Explore Ease - Your Ultimate Travel Companion</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #10b981;
            --accent: #f59e0b;
        }
        
        body {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
        }
        
        .loader {
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .card-transition {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .custom-marker {
            background: transparent;
            border: none;
        }
        
        .hotel-icon {
            background-color: #ef4444;
            color: white;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border: 2px solid white;
        }
        
        .primary-btn {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.3), 0 2px 4px -1px rgba(79, 70, 229, 0.1);
        }
        
        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.3), 0 4px 6px -2px rgba(79, 70, 229, 0.1);
        }
        
        .map-container {
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .input-field {
            transition: all 0.3s ease;
            border: 1px solid #e2e8f0;
            background-color: #f8fafc;
        }
        
        .input-field:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
            background-color: white;
        }
        
        .header-gradient {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            position: relative;
            overflow: hidden;
        }
        
        .header-gradient::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 40%;
            background-image: url('https://images.unsplash.com/photo-1506929562872-bb421503ef21?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80');
            background-size: cover;
            background-position: center;
            opacity: 0.15;
            mask-image: linear-gradient(to left, rgba(0,0,0,1) 0%, transparent 100%);
        }
        
        .place-card-image {
            height: 180px;
            transition: transform 0.5s ease;
        }
        
        .place-card:hover .place-card-image {
            transform: scale(1.05);
        }
        
        .category-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background-color: rgba(255,255,255,0.9);
            backdrop-filter: blur(4px);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .section-title {
            position: relative;
            display: inline-block;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 50px;
            height: 4px;
            background: var(--primary);
            border-radius: 2px;
        }

        /* Chatbot Styles */
        #chatbot-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 320px;
            max-width: 90%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
            flex-direction: column;
            border: 1px solid #e2e8f0;
        }

        #chatbot-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 12px 16px;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #chatbot-messages {
            padding: 16px;
            height: 300px;
            overflow-y: auto;
            background: #f8fafc;
        }

        .chatbot-message {
            margin-bottom: 12px;
            max-width: 80%;
            padding: 8px 12px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
        }

        .user-message {
            background: var(--primary);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }

        .bot-message {
            background: white;
            color: #1e293b;
            margin-right: auto;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        #chatbot-input-container {
            display: flex;
            padding: 12px;
            border-top: 1px solid #e2e8f0;
        }

        #chatbot-input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            outline: none;
            font-size: 14px;
        }

        #chatbot-send {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 0 16px;
            margin-left: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }

        #chatbot-send:hover {
            background: var(--primary-dark);
        }

        #chatbot-toggle {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
            cursor: pointer;
            z-index: 999;
            border: none;
        }

        #chatbot-toggle i {
            font-size: 20px;
        }

        /* Header Actions */
        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header-action {
            color: white;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .header-action:hover {
            opacity: 0.9;
        }

        .header-action i {
            font-size: 18px;
        }

        .profile-dropdown {
            position: relative;
        }

        .profile-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            min-width: 200px;
            z-index: 10;
            overflow: hidden;
        }

        .profile-dropdown:hover .profile-menu {
            display: block;
        }

        .profile-menu a {
            display: block;
            padding: 10px 16px;
            color: #1e293b;
            text-decoration: none;
            transition: background 0.2s;
        }

        .profile-menu a:hover {
            background: #f1f5f9;
        }

        .profile-menu a i {
            margin-right: 8px;
            width: 20px;
            text-align: center;
        }
    </style>
</head>
<body class="font-sans antialiased">
    <!-- Chatbot Toggle Button -->
    <button id="chatbot-toggle">
        <i class="fas fa-comment-alt"></i>
    </button>

    <!-- Chatbot Container -->
    <div id="chatbot-container">
        <div id="chatbot-header">
            <span>Travel Assistant</span>
            <button id="chatbot-close" style="background: none; border: none; color: white; cursor: pointer;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="chatbot-messages">
            <div class="chatbot-message bot-message">
                Hi there! I'm your travel assistant. How can I help you today?
            </div>
        </div>
        <div id="chatbot-input-container">
            <input type="text" id="chatbot-input" placeholder="Type your message...">
            <button id="chatbot-send">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <div id="root" class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header with Gradient Background -->
        <header class="header-gradient text-white rounded-2xl p-8 mb-10 shadow-xl relative overflow-hidden">
            <div class="flex items-center justify-between relative z-10">
                <div>
                    <h1 class="text-5xl font-bold mb-3">Explore Ease</h1>
                    <p class="text-xl opacity-90">Plan your perfect journey with ease</p>
                    <div class="mt-6 flex space-x-3">
                        <span class="bg-white/20 px-3 py-1 rounded-full text-sm flex items-center">
                            <i class="fas fa-map-marked-alt mr-2"></i> 50,000+ destinations
                        </span>
                        <span class="bg-white/20 px-3 py-1 rounded-full text-sm flex items-center">
                            <i class="fas fa-users mr-2"></i> Trusted by 1M+ travelers
                        </span>
                    </div>
                </div>
                <div class="hidden lg:flex items-center gap-6">
                    <!-- Header Actions -->
                    <div class="header-actions">
                        <div class="header-action" onclick="document.getElementById('chatbot-container').style.display = 'flex'">
                            <i class="fas fa-question-circle"></i>
                            <span>Help</span>
                        </div>
                        
                        <div class="profile-dropdown">
                            <div class="header-action">
                                <i class="fas fa-user-circle"></i>
                                <span>Profile</span>
                                <i class="fas fa-chevron-down text-xs"></i>
                            </div>
                            <div class="profile-menu">
                                <a href="#"><i class="fas fa-user"></i> My Account</a>
                                <a href="#"><i class="fas fa-heart"></i> Saved Trips</a>
                                <a href="#"><i class="fas fa-cog"></i> Settings</a>
                                <a href="#"><i class="fas fa-sign-out-alt"></i> Logout</a>
                            </div>
                        </div>
                    </div>
                    
                    <img src="https://images.unsplash.com/photo-1503220317375-aaad61436b1b?ixlib=rb-1.2.1&auto=format&fit=crop&w=200&h=200&q=80" alt="Travel" class="w-48 h-48 object-cover rounded-full border-4 border-white/30 shadow-lg">
                </div>
            </div>
        </header>
        
        <!-- Error Message -->
        <div id="error-message" class="bg-red-100 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded-lg relative hidden mb-6" role="alert">
            <div class="flex items-center">
                <div class="py-1">
                    <i class="fas fa-exclamation-circle text-red-500 mr-4"></i>
                </div>
                <div>
                    <strong class="font-bold">Error: </strong>
                    <span id="error-text" class="block sm:inline"></span>
                </div>
                <span class="absolute top-0 right-0 px-4 py-3">
                    <i class="fas fa-times cursor-pointer hover:text-red-900" onclick="document.getElementById('error-message').classList.add('hidden')"></i>
                </span>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Search and Filter Section -->
            <div class="bg-white p-6 rounded-2xl shadow-xl border border-white/30">
                <h2 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-3 flex items-center">
                    <i class="fas fa-map-marked-alt mr-3 text-indigo-500"></i>
                    Plan Your Adventure
                </h2>
                <form id="travel-form" class="space-y-5">
                    <div>
                        <label class="block mb-2 font-medium text-gray-700">Current Location</label>
                        <div class="relative">
                            <input type="text" id="current-location" class="w-full p-3 input-field rounded-xl pl-11 focus:outline-none" placeholder="Auto-detecting...">
                            <i class="fas fa-map-marker-alt absolute left-3 top-3.5 text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block mb-2 font-medium text-gray-700">Dream Destination</label>
                        <div class="relative">
                            <input type="text" id="destination" class="w-full p-3 input-field rounded-xl pl-11 focus:outline-none" placeholder="Where to?">
                            <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block mb-2 font-medium text-gray-700">From Date</label>
                            <div class="relative">
                                <input type="date" id="from-date" class="w-full p-3 input-field rounded-xl pl-11 focus:outline-none">
                                <i class="fas fa-calendar-day absolute left-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                        <div>
                            <label class="block mb-2 font-medium text-gray-700">To Date</label>
                            <div class="relative">
                                <input type="date" id="to-date" class="w-full p-3 input-field rounded-xl pl-11 focus:outline-none">
                                <i class="fas fa-calendar-day absolute left-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block mb-2 font-medium text-gray-700">Adults</label>
                            <div class="relative">
                                <input type="number" id="adults" class="w-full p-3 input-field rounded-xl pl-11 focus:outline-none" min="1" value="2">
                                <i class="fas fa-user absolute left-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                        <div>
                            <label class="block mb-2 font-medium text-gray-700">Children</label>
                            <div class="relative">
                                <input type="number" id="children" class="w-full p-3 input-field rounded-xl pl-11 focus:outline-none" min="0" value="0">
                                <i class="fas fa-child absolute left-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pt-2">
                        <button type="submit" class="w-full primary-btn text-white p-4 rounded-xl flex items-center justify-center">
                            <i class="fas fa-search mr-3"></i> Discover Travel Options
                        </button>
                    </div>
                    
                    <!-- Hotel Search Button -->
                    <div class="pt-2">
                        <button type="button" id="show-hotels-btn" class="w-full bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl flex items-center justify-center hover:from-red-600 hover:to-red-700 transition-all shadow-lg hover:shadow-xl">
                            <i class="fas fa-hotel mr-3"></i> Find Luxury Hotels
                        </button>
                    </div>
                </form>
                
                <!-- Travel Tips Section -->
                <div class="mt-8 pt-6 border-t border-gray-100">
                    <h3 class="font-bold text-lg text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-lightbulb text-yellow-500 mr-2"></i> Travel Tips
                    </h3>
                    <div class="space-y-3">
                        <div class="flex items-start">
                            <div class="bg-indigo-100 p-2 rounded-lg mr-3">
                                <i class="fas fa-passport text-indigo-500"></i>
                            </div>
                            <p class="text-sm text-gray-600">Check passport validity - should have 6+ months remaining</p>
                        </div>
                        <div class="flex items-start">
                            <div class="bg-indigo-100 p-2 rounded-lg mr-3">
                                <i class="fas fa-cloud-sun text-indigo-500"></i>
                            </div>
                            <p class="text-sm text-gray-600">Check weather forecasts before packing</p>
                        </div>
                        <div class="flex items-start">
                            <div class="bg-indigo-100 p-2 rounded-lg mr-3">
                                <i class="fas fa-wifi text-indigo-500"></i>
                            </div>
                            <p class="text-sm text-gray-600">Download offline maps for your destination</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Map and Results Section -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Map Container -->
                <div class="map-container bg-white p-1 rounded-2xl shadow-xl">
                    <div id="map" class="h-96 w-full rounded-xl"></div>
                    <div id="route-info" class="mt-2 p-4 bg-indigo-50 rounded-b-xl"></div>
                </div>
                
                <!-- Loading Spinner -->
                <div id="places-loader" class="hidden flex justify-center items-center p-8 bg-white rounded-2xl shadow-lg">
                    <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12"></div>
                    <span class="ml-4 text-lg text-gray-600">Discovering amazing places...</span>
                </div>
                
                <!-- Top Places Section -->
                <div class="bg-white p-6 rounded-2xl shadow-xl">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                            <i class="fas fa-map-marker-alt mr-3 text-indigo-500"></i>
                            Must-Visit Places
                        </h2>
                        <div class="flex space-x-2">
                            <button class="px-4 py-2 bg-indigo-100 text-indigo-600 rounded-full text-sm hover:bg-indigo-200 transition">All</button>
                            <button class="px-4 py-2 bg-gray-100 text-gray-600 rounded-full text-sm hover:bg-gray-200 transition">Landmarks</button>
                            <button class="px-4 py-2 bg-gray-100 text-gray-600 rounded-full text-sm hover:bg-gray-200 transition">Museums</button>
                            <button class="px-4 py-2 bg-gray-100 text-gray-600 rounded-full text-sm hover:bg-gray-200 transition">Nature</button>
                        </div>
                    </div>
                    <div id="top-places" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5"></div>
                </div>
            </div>
        </div>

        <!-- Newsletter Section -->
        <div class="mt-16 bg-gradient-to-r from-indigo-500 to-indigo-600 rounded-2xl p-8 text-white shadow-xl">
            <div class="max-w-3xl mx-auto text-center">
                <h2 class="text-3xl font-bold mb-4">Get Travel Inspiration</h2>
                <p class="text-lg mb-6 opacity-90">Subscribe to our newsletter for exclusive travel deals, tips, and destination guides.</p>
                <div class="flex flex-col sm:flex-row gap-3 max-w-md mx-auto">
                    <input type="email" placeholder="Your email address" class="flex-grow p-3 rounded-lg text-gray-800 focus:outline-none">
                    <button class="bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-bold px-6 py-3 rounded-lg transition shadow-lg">
                        Subscribe
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const currentLocationInput = document.getElementById('current-location');
        const placesLoader = document.getElementById('places-loader');
        const placesContainer = document.getElementById('top-places');
        const errorMessageEl = document.getElementById('error-message');
        const errorTextEl = document.getElementById('error-text');
        const showHotelsBtn = document.getElementById('show-hotels-btn');

        let map, currentMarker, destinationMarker, routeLayer;
        let hotelMarkers = [];
        let destinationCoords = null;
        
        // Initialize map with better styling
        map = L.map('map', {
            zoomControl: false,
            gestureHandling: true,
            preferCanvas: true
        }).setView([0, 0], 2);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors',
            maxZoom: 18
        }).addTo(map);
        
        // Add custom zoom controls
        L.control.zoom({
            position: 'topright'
        }).addTo(map);

        // Error handling function
        function showError(message) {
            errorMessageEl.classList.remove('hidden');
            errorTextEl.textContent = message;
        }

        function hideError() {
            errorMessageEl.classList.add('hidden');
            errorTextEl.textContent = '';
        }

        // Clear all hotel markers
        function clearHotelMarkers() {
            hotelMarkers.forEach(marker => map.removeLayer(marker));
            hotelMarkers = [];
        }

        // Add hotel markers to map
        function addHotelMarkers(hotels) {
            clearHotelMarkers();
            
            hotels.forEach(hotel => {
                const marker = L.marker([hotel.lat, hotel.lon], {
                    icon: L.divIcon({
                        className: 'custom-marker',
                        html: '<div class="hotel-icon"><i class="fas fa-hotel"></i></div>'
                    })
                })
                .addTo(map)
                .bindPopup(`
                    <div class="p-2">
                        <h3 class="font-bold text-lg text-gray-800">${hotel.name}</h3>
                        <p class="text-sm text-gray-600 mt-1"><i class="fas fa-map-marker-alt mr-1 text-blue-500"></i> ${hotel.address || 'Address not available'}</p>
                        <p class="text-sm text-gray-600 mt-1"><i class="fas fa-phone mr-1 text-blue-500"></i> ${hotel.contact || 'Phone not available'}</p>
                        <div class="flex justify-between items-center mt-2">
                            <div class="flex">
                                ${Array.from({length: 5}, (_, i) => 
                                    `<i class="fas fa-star ${i < hotel.rating ? 'text-yellow-400' : 'text-gray-300'} text-sm"></i>`
                                ).join('')}
                            </div>
                            <span class="bg-green-500 text-white text-xs px-2 py-1 rounded-full">$${hotel.price}/night</span>
                        </div>
                        ${hotel.website ? `<a href="${hotel.website}" target="_blank" class="text-blue-500 text-xs mt-2 block hover:underline"><i class="fas fa-external-link-alt mr-1"></i>Visit Website</a>` : ''}
                    </div>
                `);
                
                hotelMarkers.push(marker);
            });
            
            // Show success message
            const routeInfo = document.getElementById('route-info');
            routeInfo.innerHTML = `
                <div class="flex items-center text-green-700">
                    <i class="fas fa-check-circle mr-2"></i>
                    <span>Showing ${hotels.length} hotels near destination</span>
                </div>
            `;
        }

        // Search for hotels near a location using real OpenStreetMap data
        async function searchHotels(lat, lon) {
            try {
                // Show loading state
                const routeInfo = document.getElementById('route-info');
                routeInfo.innerHTML = `
                    <div class="flex items-center text-blue-600">
                        <div class="loader ease-linear rounded-full border-2 border-t-2 border-gray-200 h-4 w-4 mr-2"></div>
                        <span>Finding the best hotels for you...</span>
                    </div>
                `;
                
                // Use Overpass API to find real hotels
                const radius = 5000; // 5km radius
                const overpassQuery = `
                    [out:json];
                    (
                        node["tourism"="hotel"](around:${radius},${lat},${lon});
                        way["tourism"="hotel"](around:${radius},${lat},${lon});
                        relation["tourism"="hotel"](around:${radius},${lat},${lon});
                    );
                    out center 20;
                `;
                
                const overpassUrl = 'https://overpass-api.de/api/interpreter';
                const response = await axios.post(overpassUrl, overpassQuery, {
                    headers: { 'Content-Type': 'text/plain' }
                });

                const hotels = response.data.elements.map(element => {
                    const hotelLat = element.lat || (element.center && element.center.lat);
                    const hotelLon = element.lon || (element.center && element.center.lon);
                    
                    return {
                        name: element.tags.name || 'Hotel',
                        lat: hotelLat,
                        lon: hotelLon,
                        address: element.tags['addr:street'] 
                            ? `${element.tags['addr:street']} ${element.tags['addr:housenumber'] || ''}, ${element.tags['addr:city'] || ''}`
                            : 'Address not available',
                        contact: element.tags.phone || element.tags['contact:phone'] || 'Phone not available',
                        rating: element.tags.stars ? parseInt(element.tags.stars) : Math.floor(Math.random() * 2) + 3,
                        price: Math.floor(Math.random() * 300) + 100,
                        website: element.tags.website || element.tags['contact:website'] || null
                    };
                }).filter(hotel => hotel.lat && hotel.lon);

                if (hotels.length === 0) {
                    showError("No hotels found in this area. Try a different location.");
                    routeInfo.innerHTML = `
                        <div class="flex items-center text-yellow-700">
                            <i class="fas fa-info-circle mr-2"></i>
                            <span>No hotels found nearby</span>
                        </div>
                    `;
                    return;
                }
                
                addHotelMarkers(hotels);
            } catch (error) {
                console.error('Hotel search error:', error);
                showError("Could not load hotels. Please try again.");
                const routeInfo = document.getElementById('route-info');
                routeInfo.innerHTML = '';
            }
        }

        // Geolocation API for current location
        function getCurrentLocation() {
            return new Promise((resolve, reject) => {
                if ("geolocation" in navigator) {
                    navigator.geolocation.getCurrentPosition(
                        position => {
                            const coords = position.coords;
                            resolve(coords);
                        },
                        error => {
                            showError("Geolocation error: " + error.message);
                            reject(error);
                        },
                        { enableHighAccuracy: true }
                    );
                } else {
                    showError("Geolocation not supported");
                    reject("Geolocation not supported");
                }
            });
        }

        // Reverse Geocoding to get city name
        async function reverseGeocode(lat, lon) {
            try {
                // Using OpenStreetMap Nominatim
                const response = await axios.get(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
                const address = response.data.address;
                return `${address.city || address.town || address.village || address.county}, ${address.country}`;
            } catch (error) {
                console.error('Reverse geocoding error:', error);
                return `Lat: ${lat}, Lon: ${lon}`;
            }
        }

        // Geocoding for destination
        async function geocodeLocation(location) {
            try {
                // Using OpenStreetMap Nominatim
                const response = await axios.get(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}`);
                if (response.data && response.data.length > 0) {
                    return {
                        lat: parseFloat(response.data[0].lat),
                        lon: parseFloat(response.data[0].lon),
                        name: response.data[0].display_name
                    };
                }
                
                throw new Error("Location not found");
            } catch (error) {
                console.error('Geocoding error:', error);
                showError("Unable to find location. Please try a different name.");
                return null;
            }
        }

        // Helper function to calculate distance between two coordinates
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radius of the Earth in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                     Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Fetch real places to visit using Overpass API
        async function fetchTopPlaces(lat, lon) {
            placesLoader.classList.remove('hidden');
            placesContainer.innerHTML = '';

            try {
                // Use Overpass API to find tourist attractions
                const radius = 5000; // 5km radius
                const overpassQuery = `
                    [out:json];
                    (
                        node["tourism"~"attraction|museum|viewpoint|artwork|gallery"](around:${radius},${lat},${lon});
                        node["historic"~"monument|castle|ruins|memorial"](around:${radius},${lat},${lon});
                        node["leisure"~"park|garden|nature_reserve"](around:${radius},${lat},${lon});
                        way["tourism"~"attraction|museum|viewpoint|artwork|gallery"](around:${radius},${lat},${lon});
                        way["historic"~"monument|castle|ruins|memorial"](around:${radius},${lat},${lon});
                        way["leisure"~"park|garden|nature_reserve"](around:${radius},${lat},${lon});
                    );
                    out center 20;
                `;
                
                const overpassUrl = 'https://overpass-api.de/api/interpreter';
                const response = await axios.post(overpassUrl, overpassQuery, {
                    headers: { 'Content-Type': 'text/plain' }
                });

                const places = response.data.elements.map(element => {
                    const placeLat = element.lat || (element.center && element.center.lat);
                    const placeLon = element.lon || (element.center && element.center.lon);
                    
                    // Calculate distance from destination
                    const distance = calculateDistance(lat, lon, placeLat, placeLon);
                    
                    // Determine category
                    let category = 'Attraction';
                    if (element.tags.tourism === 'museum') category = 'Museum';
                    else if (element.tags.tourism === 'viewpoint') category = 'Viewpoint';
                    else if (element.tags.tourism === 'gallery') category = 'Art Gallery';
                    else if (element.tags.historic) category = 'Historical';
                    else if (element.tags.leisure === 'park' || element.tags.leisure === 'garden') category = 'Park';
                    else if (element.tags.leisure === 'nature_reserve') category = 'Nature';
                    
                    // Get a category-appropriate image
                    const categoryImages = {
                        'Museum': 'https://images.unsplash.com/photo-1587825140708-dfaf72ae4b04?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&h=400&q=80',
                        'Park': 'https://images.unsplash.com/photo-1493246507139-91e8fad9978e?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&h=400&q=80',
                        'Art Gallery': 'https://images.unsplash.com/photo-1518998053901-5348d3961a04?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&h=400&q=80',
                        'Viewpoint': 'https://images.unsplash.com/photo-1501785888041-af3ef285b470?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&h=400&q=80',
                        'Historical': 'https://images.unsplash.com/photo-1529655683826-aba9b3e77383?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&h=400&q=80',
                        'Nature': 'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&h=400&q=80',
                        'Attraction': 'https://images.unsplash.com/photo-1513635269975-59663e0ac1ad?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&h=400&q=80'
                    };
                    
                    return {
                        name: element.tags.name || 'Unnamed Place',
                        category: category,
                        distance: distance.toFixed(1) + ' km',
                        photo: categoryImages[category] || categoryImages['Attraction'],
                        rating: (4.5 + Math.random() * 0.4).toFixed(1),
                        description: element.tags.description || element.tags['description:en'] || '',
                        website: element.tags.website || element.tags['contact:website'] || null,
                        lat: placeLat,
                        lon: placeLon
                    };
                }).filter(place => place.name !== 'Unnamed Place');

                if (places.length === 0) {
                    placesContainer.innerHTML = `
                        <div class="col-span-full text-center py-8">
                            <i class="fas fa-map-marker-alt text-gray-300 text-5xl mb-4"></i>
                            <p class="text-gray-500">No tourist attractions found in this area.</p>
                            <p class="text-gray-400 text-sm mt-2">Try searching for a different destination.</p>
                        </div>
                    `;
                } else {
                    // Sort by distance and take top 6
                    const sortedPlaces = places.sort((a, b) => 
                        parseFloat(a.distance) - parseFloat(b.distance)
                    ).slice(0, 6);

                    placesContainer.innerHTML = sortedPlaces.map(place => `
                        <div class="bg-white rounded-xl shadow-md overflow-hidden card-hover card-transition border border-gray-100 place-card">
                            <div class="h-48 overflow-hidden relative place-card-image-container">
                                <img src="${place.photo}" alt="${place.name}" class="w-full h-full object-cover place-card-image">
                                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4">
                                    <h3 class="font-bold text-lg text-white">${place.name}</h3>
                                </div>
                                <div class="category-badge">${place.category}</div>
                            </div>
                            <div class="p-4">
                                <div class="flex justify-between items-start mb-2">
                                    <p class="text-gray-600 text-sm flex items-center">
                                        <i class="fas fa-map-marker-alt mr-2 text-indigo-500"></i> ${place.distance} away
                                    </p>
                                    <div class="flex items-center bg-indigo-50 px-2 py-1 rounded-full">
                                        <i class="fas fa-star text-yellow-400 text-xs mr-1"></i>
                                        <span class="text-xs font-bold text-indigo-700">${place.rating}</span>
                                    </div>
                                </div>
                                ${place.website ? `
                                    <button onclick="window.open('${place.website}', '_blank')" class="w-full mt-2 bg-indigo-50 hover:bg-indigo-100 text-indigo-600 text-sm font-medium py-2 px-4 rounded-lg transition">
                                        <i class="fas fa-external-link-alt mr-2"></i>Visit Website
                                    </button>
                                ` : `
                                    <button onclick="window.open('https://www.google.com/maps/search/?api=1&query=${place.lat},${place.lon}', '_blank')" class="w-full mt-2 bg-indigo-50 hover:bg-indigo-100 text-indigo-600 text-sm font-medium py-2 px-4 rounded-lg transition">
                                        <i class="fas fa-map mr-2"></i>View on Map
                                    </button>
                                `}
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Places API error:', error);
                showError("Could not load places. Please try again.");
                placesContainer.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <i class="fas fa-exclamation-circle text-red-300 text-5xl mb-4"></i>
                        <p class="text-red-500">Failed to load attractions.</p>
                        <p class="text-gray-400 text-sm mt-2">Please try again later.</p>
                    </div>
                `;
            } finally {
                placesLoader.classList.add('hidden');
            }
        }

        // Automatic location detection on page load
        async function initializeLocation() {
            try {
                hideError();
                const coords = await getCurrentLocation();
                const cityName = await reverseGeocode(coords.latitude, coords.longitude);
                currentLocationInput.value = cityName;

                // Add marker for current location
                if (currentMarker) map.removeLayer(currentMarker);
                currentMarker = L.marker([coords.latitude, coords.longitude], {
                    icon: L.divIcon({
                        className: 'custom-marker',
                        html: '<div class="bg-indigo-500 text-white rounded-full p-3 flex items-center justify-center shadow-lg"><i class="fas fa-map-marker-alt"></i></div>'
                    })
                })
                .addTo(map)
                .bindPopup(`<b>Your Location</b><br>${cityName}`)
                .openPopup();

                map.setView([coords.latitude, coords.longitude], 12);
            } catch (error) {
                showError("Could not detect current location. Please enter it manually.");
            }
        }

        // Initial location detection
        initializeLocation();

        // Form submission handler
        document.getElementById('travel-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            hideError();
            clearHotelMarkers();
            
            const currentLocation = currentLocationInput.value;
            const destination = document.getElementById('destination').value;

            if (!destination) {
                showError("Please enter a destination");
                return;
            }

            try {
                const currentGeo = await geocodeLocation(currentLocation);
                const destGeo = await geocodeLocation(destination);

                if (currentGeo && destGeo) {
                    destinationCoords = { lat: destGeo.lat, lon: destGeo.lon };
                    
                    // Set map markers
                    if (currentMarker) map.removeLayer(currentMarker);
                    if (destinationMarker) map.removeLayer(destinationMarker);

                    currentMarker = L.marker([currentGeo.lat, currentGeo.lon], {
                        icon: L.divIcon({
                            className: 'custom-marker',
                            html: '<div class="bg-indigo-500 text-white rounded-full p-3 flex items-center justify-center shadow-lg"><i class="fas fa-map-marker-alt"></i></div>'
                        })
                    })
                    .addTo(map)
                    .bindPopup(`<b>Current Location</b><br>${currentGeo.name}`);
                    
                    destinationMarker = L.marker([destGeo.lat, destGeo.lon], {
                        icon: L.divIcon({
                            className: 'custom-marker',
                            html: '<div class="bg-red-500 text-white rounded-full p-3 flex items-center justify-center shadow-lg"><i class="fas fa-map-marker-alt"></i></div>'
                        })
                    })
                    .addTo(map)
                    .bindPopup(`<b>Destination</b><br>${destGeo.name}`);

                    // Draw route between points
                    if (routeLayer) map.removeLayer(routeLayer);
                    
                    try {
                        const routeResponse = await axios.get(`https://router.project-osrm.org/route/v1/driving/${currentGeo.lon},${currentGeo.lat};${destGeo.lon},${destGeo.lat}?overview=full&geometries=geojson`);
                        const route = routeResponse.data.routes[0];
                        
                        routeLayer = L.geoJSON(route.geometry, {
                            style: {
                                color: '#4f46e5',
                                weight: 4,
                                opacity: 0.8
                            }
                        }).addTo(map);
                        
                        document.getElementById('route-info').innerHTML = `
                            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center">
                                <div>
                                    <h3 class="font-bold text-gray-800">Your Journey</h3>
                                    <div class="flex items-center text-gray-600 mt-1">
                                        <i class="fas fa-road mr-2 text-indigo-500"></i>
                                        <span>Distance: ${(route.distance / 1000).toFixed(1)} km</span>
                                    </div>
                                    <div class="flex items-center text-gray-600 mt-1">
                                        <i class="fas fa-clock mr-2 text-indigo-500"></i>
                                        <span>Estimated time: ${Math.floor(route.duration / 60)} min</span>
                                    </div>
                                </div>
                                <button class="mt-2 sm:mt-0 bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg flex items-center transition shadow-md" onclick="window.open('https://www.google.com/maps/dir/?api=1&origin=${currentGeo.lat},${currentGeo.lon}&destination=${destGeo.lat},${destGeo.lon}', '_blank')">
                                    <i class="fas fa-external-link-alt mr-2"></i> Open in Google Maps
                                </button>
                            </div>
                        `;
                    } catch (routeError) {
                        console.error('Routing error:', routeError);
                        document.getElementById('route-info').innerHTML = `
                            <div class="flex items-center text-yellow-700 bg-yellow-100 p-3 rounded">
                                <i class="fas fa-exclamation-triangle mr-2"></i>
                                <span>Could not calculate route. Showing straight line between points.</span>
                            </div>
                        `;
                        
                        // Fallback to straight line
                        routeLayer = L.polyline([
                            [currentGeo.lat, currentGeo.lon],
                            [destGeo.lat, destGeo.lon]
                        ], {
                            color: '#4f46e5',
                            weight: 2,
                            dashArray: '5,5'
                        }).addTo(map);
                    }

                    // Fit map to show both markers
                    const bounds = L.latLngBounds(
                        [currentGeo.lat, currentGeo.lon],
                        [destGeo.lat, destGeo.lon]
                    );
                    map.fitBounds(bounds, { padding: [50, 50] });

                    // Fetch nearby places for destination
                    await fetchTopPlaces(destGeo.lat, destGeo.lon);
                }
            } catch (error) {
                console.error('Form submission error:', error);
                showError("An error occurred while processing your request. Please try again.");
            }
        });

        // Show hotels button click handler
        showHotelsBtn.addEventListener('click', async () => {
            if (!destinationCoords) {
                showError("Please search for a destination first");
                return;
            }
            
            await searchHotels(destinationCoords.lat, destinationCoords.lon);
        });

        // Chatbot functionality
        const chatbotToggle = document.getElementById('chatbot-toggle');
        const chatbotContainer = document.getElementById('chatbot-container');
        const chatbotClose = document.getElementById('chatbot-close');
        const chatbotMessages = document.getElementById('chatbot-messages');
        const chatbotInput = document.getElementById('chatbot-input');
        const chatbotSend = document.getElementById('chatbot-send');

        // Toggle chatbot visibility
        chatbotToggle.addEventListener('click', () => {
            chatbotContainer.style.display = chatbotContainer.style.display === 'flex' ? 'none' : 'flex';
        });

        // Close chatbot
        chatbotClose.addEventListener('click', () => {
            chatbotContainer.style.display = 'none';
        });

        // Send message when button is clicked
        chatbotSend.addEventListener('click', sendChatbotMessage);

        // Send message when Enter is pressed
        chatbotInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendChatbotMessage();
            }
        });

        function sendChatbotMessage() {
            const message = chatbotInput.value.trim();
            if (!message) return;

            // Add user message to chat
            addMessage(message, 'user');

            // Clear input
            chatbotInput.value = '';

            // Generate bot response
            setTimeout(() => {
                const response = generateBotResponse(message);
                addMessage(response, 'bot');
            }, 500);
        }

        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('chatbot-message');
            messageDiv.classList.add(sender === 'user' ? 'user-message' : 'bot-message');
            messageDiv.textContent = text;
            chatbotMessages.appendChild(messageDiv);
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        }

        function generateBotResponse(message) {
            const lowerMessage = message.toLowerCase();

            if (lowerMessage.includes('hello') || lowerMessage.includes('hi')) {
                return "Hello! How can I assist you with your travel plans today?";
            } else if (lowerMessage.includes('hotel') || lowerMessage.includes('accommodation')) {
                return "You can find luxury hotels by clicking the 'Find Luxury Hotels' button after searching for a destination.";
            } else if (lowerMessage.includes('destination') || lowerMessage.includes('place to visit')) {
                return "After you search for a destination, I'll show you must-visit places in that location!";
            } else if (lowerMessage.includes('weather')) {
                return "I recommend checking a weather forecast service for the most accurate information about your destination's weather.";
            } else if (lowerMessage.includes('help')) {
                return "I can help you with information about destinations, hotels, and travel tips. Just ask me anything!";
            } else if (lowerMessage.includes('thank')) {
                return "You're welcome! Happy travels!";
            } else {
                return "I'm here to help with your travel questions. You can ask me about destinations, hotels, or travel tips!";
            }
        }
    });
    </script>
</body>
</html>